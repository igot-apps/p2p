
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>P2P · two‑sided merchant dashboard</title>
  <!-- Font Awesome 6 (free) for clean icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
    }

    body {
      background: #f3f6fc;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 24px 20px;
      color: #0b1c33;
    }

    .dashboard-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.9rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      color: #0f2b3d;
      letter-spacing: -0.01em;
    }

    h1 i {
      color: #2f7e4b;
    }

    h2, h3 {
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    h2 i, h3 i {
      color: #256fa0;
    }

    /* stats grid – clean and informative */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
      gap: 16px;
      margin: 24px 0 28px;
    }

    .stat-card {
      background: white;
      padding: 18px 14px;
      border-radius: 20px;
      box-shadow: 0 6px 14px rgba(0,20,40,0.04);
      border: 1px solid rgba(79, 114, 202, 0.08);
      transition: 0.2s;
    }

    .stat-card:hover {
      background: #fefefe;
      border-color: #cbddea;
    }

    .stat-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #5a6e7e;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-number {
      font-size: 1.8rem;
      font-weight: 650;
      line-height: 1.1;
      color: #0c2e4e;
    }

    .stat-sub {
      font-size: 0.8rem;
      color: #42707e;
      margin-top: 6px;
    }

    .profit-positive { color: #1e7b4b; background: #e2f0e4; padding: 2px 10px; border-radius: 40px; }
    .profit-negative { color: #b13b3b; background: #ffe6e6; padding: 2px 10px; border-radius: 40px; }

    /* two‑column layout for buy / sell */
    .dual-panel {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 26px;
      margin-bottom: 32px;
    }

    @media (max-width: 800px) {
      .dual-panel {
        grid-template-columns: 1fr;
        gap: 20px;
      }
    }

    .order-card {
      background: white;
      border-radius: 24px;
      padding: 20px 20px 26px;
      box-shadow: 0 10px 22px -6px rgba(0,0,0,0.04);
      border: 1px solid #e5ecf3;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 18px;
    }

    .badge {
      background: #ecf3fa;
      padding: 6px 14px;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      color: #1f5f8b;
    }

    .add-form {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
      background: #f9fcff;
      padding: 14px 12px;
      border-radius: 18px;
      margin-bottom: 22px;
      border: 1px solid #e2ecf5;
    }

    .add-form input {
      padding: 12px 12px;
      border: 1px solid #d3dfea;
      border-radius: 14px;
      font-size: 0.95rem;
      width: 120px;
      background: white;
      transition: 0.2s;
    }

    .add-form input:focus {
      border-color: #309b5c;
      outline: none;
      box-shadow: 0 0 0 3px rgba(46, 164, 79, 0.08);
    }

    .btn {
      border: none;
      padding: 10px 18px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: white;
      transition: all 0.15s;
      border: 1px solid transparent;
    }

    .btn-primary {
      background: #1f8650;
      color: white;
      box-shadow: 0 4px 8px rgba(28, 128, 74, 0.2);
    }

    .btn-primary:hover {
      background: #1b974a;
      transform: scale(0.98);
    }

    .btn-outline {
      border: 1px solid #c2d6e4;
      background: white;
      color: #2b4f6a;
    }

    .btn-outline:hover {
      background: #e7f0f9;
      border-color: #7fa1b7;
    }

    .btn-remove {
      background: transparent;
      color: #8f9fb1;
      padding: 6px 10px;
      border-radius: 40px;
    }

    .btn-remove:hover {
      background: #fbeaec;
      color: #c0394a;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th {
      text-align: center;
      padding: 12px 4px;
      color: #4e6a7c;
      font-weight: 600;
      border-bottom: 1px solid #dde6ed;
    }

    td {
      padding: 12px 4px;
      border-bottom: 1px solid #ecf1f6;
      text-align: center;
      color: #1f3d4c;
    }

    .empty-row td {
      padding: 24px;
      color: #8499a9;
      font-style: italic;
    }

    .total-value {
      font-weight: 700;
      color: #1b4e6e;
    }

    .sell-suggest-card {
      background: linear-gradient(105deg, #f1f9f5 0%, #f6fdfa 100%);
      border-radius: 18px;
      padding: 20px 24px;
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      border: 1px solid #c8e0d1;
    }

    .profit-input-group {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .profit-input-group input {
      padding: 12px 14px;
      border-radius: 40px;
      border: 1px solid #b9d1cf;
      width: 100px;
      font-weight: 600;
    }

    .suggested-price {
      font-size: 1.7rem;
      font-weight: 700;
      color: #1c6b3f;
      letter-spacing: -0.01em;
    }

    hr {
      border: none;
      border-top: 2px solid rgba(135, 175, 195, 0.2);
      margin: 28px 0 10px;
    }

    .fa-solid, .fa-regular { margin-right: 2px; }
  </style>
</head>
<body>
<div class="dashboard-container">

  <!-- HEADER -->
  <h1>
    <i class="fas fa-arrows-spin"></i> P2P two‑way trading
    <span style="font-size: 0.8rem; background: #ddecf0; padding: 6px 16px; border-radius: 50px; margin-left: 12px; font-weight: 500; color: #1e566e;">
      <i class="fas fa-bag-shopping"></i> BUY & SELL
    </span>
  </h1>

  <!-- COMPREHENSIVE STATS : BOTH SIDES + PROFIT -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-circle-dollar"></i> total bought</div>
      <div class="stat-number" id="totalBoughtQty">0.00</div>
      <div class="stat-sub">USDT · cost <span id="totalCostDisplay">0.00</span></div>
    </div>
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-circle-up"></i> total sold</div>
      <div class="stat-number" id="totalSoldQty">0.00</div>
      <div class="stat-sub">USDT · revenue <span id="totalRevenueDisplay">0.00</span></div>
    </div>
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-scale-balanced"></i> net USDT</div>
      <div class="stat-number" id="netQty">0.00</div>
      <div class="stat-sub">inventory (bought - sold)</div>
    </div>
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-file-invoice-dollar"></i> avg buy price</div>
      <div class="stat-number" id="avgBuyPrice">0.0000</div>
      <div class="stat-sub">per USDT</div>
    </div>
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-file-invoice-dollar"></i> avg sell price</div>
      <div class="stat-number" id="avgSellPrice">0.0000</div>
      <div class="stat-sub">per USDT</div>
    </div>
    <div class="stat-card">
      <div class="stat-label"><i class="fas fa-chart-line"></i> P/L (closed)</div>
      <div class="stat-number" id="profitLoss">0.00</div>
      <div class="stat-sub" id="profitStatus">revenue – cost</div>
    </div>
  </div>

  <!-- TWO SECTIONS: BUY ORDERS (left) + SELL ORDERS (right) -->
  <div class="dual-panel">
    
    <!-- ********** BUY SIDE ********** -->
    <div class="order-card">
      <div class="order-header">
        <h3><i class="fas fa-cart-shopping" style="color: #2e7d5e;"></i> Buy orders · open</h3>
        <span class="badge"><i class="fas fa-coin"></i> inventory</span>
      </div>

      <!-- Add buy form -->
      <div class="add-form">
        <input type="number" id="buyPrice" step="0.0001" placeholder="Price (fiat)" value="1.02">
        <input type="number" id="buyAmount" step="0.1" placeholder="Amount USDT" value="50">
        <button class="btn btn-primary" onclick="addBuyOrder()">
          <i class="fas fa-plus"></i> Add buy
        </button>
      </div>

      <!-- Buy orders table -->
      <table>
        <thead>
          <tr><th>Price</th><th>Amount USDT</th><th>Total (fiat)</th><th></th></tr>
        </thead>
        <tbody id="buyTableBody">
          <!-- dynamic rows from JS -->
        </tbody>
      </table>
      <div style="margin-top: 12px; font-size: 0.8rem; color: #4f7a8b;">
        <i class="fas fa-info-circle"></i> Total buy value: <span id="buyTotalFiat">0.00</span>
      </div>
    </div>

    <!-- ********** SELL SIDE ********** -->
    <div class="order-card">
      <div class="order-header">
        <h3><i class="fas fa-cart-shopping" style="color: #b1642b;"></i> Sell orders · open</h3>
        <span class="badge"><i class="fas fa-arrow-up"></i> ads</span>
      </div>

      <!-- Add sell form -->
      <div class="add-form">
        <input type="number" id="sellPrice" step="0.0001" placeholder="Price (fiat)" value="1.05">
        <input type="number" id="sellAmount" step="0.1" placeholder="Amount USDT" value="30">
        <button class="btn btn-primary" onclick="addSellOrder()" style="background: #b4643c;">
          <i class="fas fa-plus"></i> Add sell
        </button>
      </div>

      <!-- Sell orders table -->
      <table>
        <thead>
          <tr><th>Price</th><th>Amount USDT</th><th>Total (fiat)</th><th></th></tr>
        </thead>
        <tbody id="sellTableBody">
          <!-- dynamic rows -->
        </tbody>
      </table>
      <div style="margin-top: 12px; font-size: 0.8rem; color: #4f7a8b;">
        <i class="fas fa-info-circle"></i> Total sell value: <span id="sellTotalFiat">0.00</span>
      </div>
    </div>
  </div>

  <!-- PROFIT TARGET + SUGGESTED SELL (based on avg buy cost) -->
  <div class="sell-suggest-card">
    <div style="display: flex; align-items: center; gap: 8px;">
      <i class="fas fa-bullseye" style="font-size: 1.6rem; color: #2b6e4b;"></i>
      <div>
        <span style="font-weight: 600; font-size: 1rem;">Target profit margin</span>
        <div style="color: #3c6772; font-size: 0.8rem;">based on average buy cost</div>
      </div>
    </div>
    <div class="profit-input-group">
      <input type="number" id="profitPercent" step="0.1" value="0.8" min="0" style="width: 100px;" onchange="calculateAll()">
      <span style="font-weight: 600;">%</span>
      <button class="btn btn-outline" onclick="calculateAll()"><i class="fas fa-rotate-right"></i> apply</button>
    </div>
    <div style="text-align: right;">
      <div style="font-size: 0.8rem; color: #386a5e;">suggested sell</div>
      <span class="suggested-price" id="suggestedSellPrice">0.0000</span>
    </div>
  </div>

  <hr>
  <p style="text-align: right; color: #5f8694; font-size: 0.75rem; display: flex; gap: 16px; justify-content: flex-end;">
    <i class="fas fa-database"></i> data saved locally · both sides active
    <i class="fas fa-arrow-rotate-left" style="margin-left: 12px; cursor: pointer;" onclick="localStorage.clear(); location.reload();" title="reset demo"></i>
  </p>
</div>

<script>
  // ---------- P2P DASHBOARD : FULL BUY & SELL ----------
  // Two separate arrays for open orders
  let buyOrders = [];
  let sellOrders = [];

  // Load from localStorage
  function loadFromStorage() {
    const storedBuys = localStorage.getItem('p2p_buyOrders');
    const storedSells = localStorage.getItem('p2p_sellOrders');
    buyOrders = storedBuys ? JSON.parse(storedBuys) : [];
    sellOrders = storedSells ? JSON.parse(storedSells) : [];
  }

  // Save both arrays
  function saveToStorage() {
    localStorage.setItem('p2p_buyOrders', JSON.stringify(buyOrders));
    localStorage.setItem('p2p_sellOrders', JSON.stringify(sellOrders));
  }

  // ----- ADD BUY ORDER -----
  function addBuyOrder() {
    const price = parseFloat(document.getElementById('buyPrice').value);
    const amount = parseFloat(document.getElementById('buyAmount').value);
    if (isNaN(price) || isNaN(amount) || price <= 0 || amount <= 0) {
      alert('Enter valid price and amount');
      return;
    }
    buyOrders.push({ price, amount });
    saveToStorage();
    renderAll();
    // clear fields (optional)
    document.getElementById('buyPrice').value = '';
    document.getElementById('buyAmount').value = '';
  }

  // ----- ADD SELL ORDER -----
  function addSellOrder() {
    const price = parseFloat(document.getElementById('sellPrice').value);
    const amount = parseFloat(document.getElementById('sellAmount').value);
    if (isNaN(price) || isNaN(amount) || price <= 0 || amount <= 0) {
      alert('Enter valid price and amount');
      return;
    }
    sellOrders.push({ price, amount });
    saveToStorage();
    renderAll();
    document.getElementById('sellPrice').value = '';
    document.getElementById('sellAmount').value = '';
  }

  // ----- REMOVE BUY ORDER -----
  function removeBuyOrder(index) {
    buyOrders.splice(index, 1);
    saveToStorage();
    renderAll();
  }

  // ----- REMOVE SELL ORDER -----
  function removeSellOrder(index) {
    sellOrders.splice(index, 1);
    saveToStorage();
    renderAll();
  }

  // ----- RENDER BOTH TABLES + ALL STATS -----
  function renderAll() {
    renderBuyTable();
    renderSellTable();
    calculateAll();
  }

  // Buy table
  function renderBuyTable() {
    const tbody = document.getElementById('buyTableBody');
    tbody.innerHTML = '';
    if (buyOrders.length === 0) {
      tbody.innerHTML = '<tr class="empty-row"><td colspan="4"><i class="fas fa-box-open"></i> no buy orders</td></tr>';
      document.getElementById('buyTotalFiat').innerText = '0.00';
      return;
    }
    let totalFiat = 0;
    buyOrders.forEach((order, idx) => {
      const total = order.price * order.amount;
      totalFiat += total;
      const row = `<tr>
        <td>${order.price.toFixed(4)}</td>
        <td>${order.amount.toFixed(2)}</td>
        <td class="total-value">${total.toFixed(2)}</td>
        <td><button class="btn btn-remove" onclick="removeBuyOrder(${idx})"><i class="fas fa-trash-can"></i></button></td>
      </tr>`;
      tbody.innerHTML += row;
    });
    document.getElementById('buyTotalFiat').innerText = totalFiat.toFixed(2);
  }

  // Sell table
  function renderSellTable() {
    const tbody = document.getElementById('sellTableBody');
    tbody.innerHTML = '';
    if (sellOrders.length === 0) {
      tbody.innerHTML = '<tr class="empty-row"><td colspan="4"><i class="fas fa-box-open"></i> no sell orders</td></tr>';
      document.getElementById('sellTotalFiat').innerText = '0.00';
      return;
    }
    let totalFiat = 0;
    sellOrders.forEach((order, idx) => {
      const total = order.price * order.amount;
      totalFiat += total;
      const row = `<tr>
        <td>${order.price.toFixed(4)}</td>
        <td>${order.amount.toFixed(2)}</td>
        <td class="total-value">${total.toFixed(2)}</td>
        <td><button class="btn btn-remove" onclick="removeSellOrder(${idx})"><i class="fas fa-trash-can"></i></button></td>
      </tr>`;
      tbody.innerHTML += row;
    });
    document.getElementById('sellTotalFiat').innerText = totalFiat.toFixed(2);
  }

  // ----- MAIN CALCULATION: totals, averages, profit, suggested sell -----
  function calculateAll() {
    // --- BUY SIDE aggregates ---
    let totalBoughtQty = 0;
    let totalCost = 0;
    buyOrders.forEach(o => {
      totalBoughtQty += o.amount;
      totalCost += o.price * o.amount;
    });

    // --- SELL SIDE aggregates ---
    let totalSoldQty = 0;
    let totalRevenue = 0;
    sellOrders.forEach(o => {
      totalSoldQty += o.amount;
      totalRevenue += o.price * o.amount;
    });

    // NET USDT inventory
    const netQty = totalBoughtQty - totalSoldQty;

    // Averages
    const avgBuy = totalBoughtQty > 0 ? totalCost / totalBoughtQty : 0;
    const avgSell = totalSoldQty > 0 ? totalRevenue / totalSoldQty : 0;

    // Profit / loss (if we consider all sells executed)
    const profit = totalRevenue - totalCost;

    // update stats grid
    document.getElementById('totalBoughtQty').innerText = totalBoughtQty.toFixed(2);
    document.getElementById('totalCostDisplay').innerText = totalCost.toFixed(2);
    document.getElementById('totalSoldQty').innerText = totalSoldQty.toFixed(2);
    document.getElementById('totalRevenueDisplay').innerText = totalRevenue.toFixed(2);
    document.getElementById('netQty').innerText = netQty.toFixed(2);
    document.getElementById('avgBuyPrice').innerText = avgBuy.toFixed(4);
    document.getElementById('avgSellPrice').innerText = avgSell.toFixed(4);
    
    // profit / loss with styling
    const profitEl = document.getElementById('profitLoss');
    profitEl.innerText = profit.toFixed(2);
    const profitStatus = document.getElementById('profitStatus');
    if (profit > 0) {
      profitEl.style.color = '#1e7b4b';
      profitStatus.innerHTML = '<span style="background:#e2f0e4; padding:3px 10px; border-radius:40px;">⬆️ profit</span>';
    } else if (profit < 0) {
      profitEl.style.color = '#b13b3b';
      profitStatus.innerHTML = '<span style="background:#ffe6e6; padding:3px 10px; border-radius:40px;">⬇️ loss</span>';
    } else {
      profitEl.style.color = '#0b1c33';
      profitStatus.innerHTML = 'breakeven';
    }

    // SUGGESTED SELL based on target profit % (from avg buy)
    const targetPercent = parseFloat(document.getElementById('profitPercent').value) || 0;
    let suggestedSell = avgBuy * (1 + targetPercent / 100);
    if (avgBuy === 0) suggestedSell = 0;
    document.getElementById('suggestedSellPrice').innerText = suggestedSell.toFixed(4);
  }

  // ----- INITIAL LOAD & RENDER -----
  loadFromStorage();
  renderAll();

  // For manual profit input change
  window.calculateAll = calculateAll;
  window.addBuyOrder = addBuyOrder;
  window.addSellOrder = addSellOrder;
  window.removeBuyOrder = removeBuyOrder;
  window.removeSellOrder = removeSellOrder;
  // attach to window for inline onclick

</script>

<!-- small reset if needed (already inline) -->

</body>
</html>
